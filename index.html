<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SC: Evo Ladder</title>
  <link rel="icon" type="image/png" href="Assets/icons/favicon.png" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('Assets/background/planet_background.png') no-repeat center top scroll;
      background-size: cover;
      color: #fff;
      margin: 0;
      padding: 2rem;
    }

    @font-face {
      font-family: 'Orbitron';
      src: url('Assets/fonts/orbitron-webfont.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    @font-face {
      font-family: 'Blackpool';
      src: url('Assets/fonts/Blackpool-webfont.woff2') format('woff2');
      font-weight: normal;
      font-style: normal;
    }

    .table-wrapper {
      max-width: 835px;
      margin: 0 auto;
      border-radius: 12px;
     /* box-shadow: 0 0 15px rgba(0, 0, 0, 0.25); */
    }

    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
    }

    th,
    td {
      padding-left: 0.75rem;
      padding-right: 0.75rem;
      border: 1px solid #444;
      padding: 0.75rem;
      text-align: center;
      color: white;
    }

    th {
      background-color: #2d2d2d;
      position: relative;
    }

    th:last-child,
    td:last-child {
      border-right: none;
      box-shadow: none;
    }

    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
    }

    .tooltip .tooltip-bubble {
      visibility: hidden;
      background-color: #333;
      color: #fff;
      text-align: center;
      padding: 8px 14px;
      border-radius: 6px;
      position: absolute;
      z-index: 2000;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      white-space: normal;
      width: max-content;
      max-width: 480px;
      font-size: 0.85rem;
      font-weight: normal;
      transition: opacity 0.3s ease-in;
      line-height: 1.4;
      box-sizing: border-box;
      word-break: break-word;
    }

    .tooltip:hover .tooltip-bubble {
      visibility: visible;
      opacity: 1;
    }

    .race-icon {
      height: 20px;
      vertical-align: middle;
      margin: 0 4px;
      transition: transform 0.2s ease;
    }

    .race-icon:hover {
      transform: scale(1.15);
    }

    .title-image {
      text-align: center;
      margin: 1.5rem 0;
    }

    .title-img {
      max-width: 600px;
      width: 100%;
      height: auto;
    }

    .fade-in-top {
      opacity: 0;
      transform: translateY(-30px);
      animation: fadeInTop 1s ease-out forwards;
    }

    .fade-in-bottom {
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInBottom 1s ease-out forwards;
      animation-delay: 0.5s;
    }

    @keyframes fadeInTop {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInBottom {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .rank-S td:nth-child(6) {
      background: linear-gradient(to bottom, #65e2f5 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }

    .rank-A td:nth-child(6) {
      background: linear-gradient(to bottom, #28d6f0 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }

    .rank-B td:nth-child(6) {
      background: linear-gradient(to bottom, #2881f0 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }

    .rank-C td:nth-child(6) {
      background: linear-gradient(to bottom, #eef028 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }

    .rank-D td:nth-child(6) {
      background: linear-gradient(to bottom, #28f099 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }

    .rank-E td:nth-child(6) {
      background: linear-gradient(to bottom, #5cf028 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }

    .rank-F td:nth-child(6) {
      background: linear-gradient(to bottom, #f02828 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }

    .rank-Fm td:nth-child(6) {
      background: linear-gradient(to bottom, #800000 0%, rgba(0, 0, 0, 0) 60%, transparent 100%);
    }


    #leaderboard td {
      font-family: 'Orbitron', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      letter-spacing: 0.44px;
      font-size: 0.7rem;
    }

    .scramble-hidden {
      opacity: 0;
    }

    .inactive-risk-header {
      width: 60px;
      height: 36px;
      background: transparent !important;
      border: none !important;
      border-left: none;
      box-shadow: none !important;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    #leaderboard th {
      font-family: 'Blackpool', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      letter-spacing: 0.3px;
      /* Optional flair */
      font-size: 1.5rem;
      /* Adjust for readability */
    }

    .inactive-risk-hidden {
      width: 60px;
      background: transparent;
      border: none !important;
      border-left: none;
      box-shadow: none !important;
      padding: 0;
      text-align: center;
    }

    .inactive-risk-visible {
      width: 220px;
      border-left: none;
      box-shadow: none;
    }

    .danger-icon {
      height: 20px;
      vertical-align: middle;
      width: auto;
      display: inline-block;
    }

    .question-icon {
      height: 20px;
      margin-top: 4.5px;
      vertical-align: middle;
      width: auto;
      display: inline-block;
    }

    .glow-terran {
      text-shadow: 0 0 8px rgba(100, 170, 255, 1);
    }

    .glow-zerg {
      text-shadow: 0 0 8px rgba(255, 100, 100, 1);
    }

    .glow-protoss {
      text-shadow: 0 0 8px rgba(100, 255, 150, 1);
    }

    .glow-random {
      text-shadow: 0 0 8px rgba(255, 255, 100, 1);
    }

    .glow-unknown {
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
    }
  </style>
</head>

<body>
  <div class="title-image fade-in-top">
    <img src="Assets/titles/title_a.png" alt="StarCraft: Evolution Complete" class="title-img" />
  </div>
  <div class="table-wrapper fade-in-bottom">
    <table id="leaderboard">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
  <script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSy8FqFeV1ehxYkcARDbImfb3UEPX9tnFodJk5q4bntnlg_nxHRMSLkhK1R5cedyE_qQt3j_hnM9bq8/pub?gid=172854205&single=true&output=csv';

    function createRaceIcons(raceValue) {
      const iconBasePath = 'Assets/icons/';
      const knownRaces = [
        'BW Terran', 'BW Zerg', 'BW Protoss',
        'SC2 Terran', 'SC2 Zerg', 'SC2 Protoss'
      ];

      if (raceValue === 'Random' || raceValue === 'Unknown') {
        return raceValue;
      }

      const races = raceValue.split(' / ');
      return races.map(r => {
        if (knownRaces.includes(r)) {
          const clean = r.replace(' ', '_');
          const labelMap = {
            'BW Terran': 'Brood War Terran',
            'BW Zerg': 'Brood War Zerg',
            'BW Protoss': 'Brood War Protoss',
            'SC2 Terran': 'StarCraft 2 Terran',
            'SC2 Zerg': 'StarCraft 2 Zerg',
            'SC2 Protoss': 'StarCraft 2 Protoss'
          };
          const label = labelMap[r] || r;
          return `<img class="race-icon" src="${iconBasePath}${clean}_Small.png" alt="${label}" title="${label}" />`;
        } else {
          return r;
        }
      }).join('');
    }
    function scrambleText(element, finalText, duration = 800, charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789") {
      const frameRate = 30;
      const steps = Math.floor(duration / frameRate);
      let currentStep = 0;

      const scrambleInterval = setInterval(() => {
        let display = '';
        for (let i = 0; i < finalText.length; i++) {
          if (currentStep < steps) {
            display += charset[Math.floor(Math.random() * charset.length)];
          } else {
            display += finalText[i];
          }
        }

        element.textContent = display;
        currentStep++;

        if (currentStep > steps) clearInterval(scrambleInterval);
      }, frameRate);
    }

    fetch(CSV_URL)
      .then(res => res.text())
      .then(csv => {
        /*const rows = csv.trim().split('\n').map(row => row.split(','));*/
        const rows = csv
          .trim()
          .split('\n')
          .map(row => row.split(','))
          .filter(row => row.some(cell => cell.trim() !== ''));

        const [headers, ...data] = rows;

        const thead = document.querySelector('#leaderboard thead');
        const tbody = document.querySelector('#leaderboard tbody');

        const tooltipMap = {
          'Race': "Players in StarCraft: Evolution Complete compete with both factions in StarCraft: Brood War as well as StarCraft 2, and both of their preferred choices are reflected here in the table below. If Unknown is displayed, the Player may not have enough games with a chosen pair.",
          'Rating': "Evogulac uses the Glicko-2 Rating System and aims to pay homage to Aligulac from StarCraft 2, all players begin at 1500 and gain and lose points accordingly. The higher, the stronger the player.",
          'RD': "Rating Deviation, the system's measurement of certainty. The lower the deviation, the more stable.",
          'Volatility': "Volatility is the measurement of how much a player's rating tends to swing, it begins at .06 at the beginning of the system and shifts over time.",
          'Rank': "Evogulac uses the system similar to ICcup and Fish from Brood War's Ladder clients, a taste for our upcoming Ladder system. You'll have to compete to see what leads to where!",
          'InactiveRisk': "Players will be marked as At Risk for inactivity after being inactive for 3 weeks, or roughly 3 tournament cycles."
        };

        thead.innerHTML = `<tr>${headers.map(h => {
          const cleanHeader = h.trim();
          if (cleanHeader === 'InactiveRisk') {
            return `<th class="inactive-risk-header tooltip">
              <img src="Assets/icons/question_mark.png" class="question-icon" alt="Inactive Risk" />
              <div class="tooltip-bubble">${tooltipMap[cleanHeader]}</div>
            </th>`;
          }
          if (tooltipMap[cleanHeader]) {
            return `<th><div class="tooltip">${cleanHeader}<div class="tooltip-bubble">${tooltipMap[cleanHeader]}</div></div></th>`;
          }
          return `<th>${cleanHeader}</th>`;
        }).join('')}</tr>`;

        data.forEach(row => {
          if (parseFloat(row[headers.indexOf('RD')]) > 220) return;

          const rankClass = 'rank-' + row[5];
          const tr = document.createElement('tr');
          tr.className = rankClass;
          tr.innerHTML = row.map((cell, i) => {
            const isVolatility = headers[i]?.trim().toLowerCase() === 'volatility';
            const isInactiveRisk = headers[i]?.trim() === 'InactiveRisk';
            const paddingStyle = isVolatility ? 'padding-left: 0.25rem; padding-right: 0.25rem;' : '';

            if (i === 0) {
              const race = row[1];
              let glowClass = 'glow-unknown';
              if (race.includes('Terran')) glowClass = 'glow-terran';
              else if (race.includes('Zerg')) glowClass = 'glow-zerg';
              else if (race.includes('Protoss')) glowClass = 'glow-protoss';
              else if (race === 'Random') glowClass = 'glow-random';
              else if (race === 'Unknown') glowClass = 'glow-unknown';
              return `<td class="${glowClass}" style="${paddingStyle}">${cell}</td>`;
            }

            if (i === 1) {
              return `<td>${createRaceIcons(cell)}</td>`;
            }

            if (isInactiveRisk) {
              if (cell === '1') {
                return `<td class="inactive-risk-visible tooltip">
                  <img src="Assets/icons/danger_expire.png" class="danger-icon" alt="At Risk" />
                  <div class="tooltip-bubble">This player is marked At Risk!</div>
                </td>`;
              }
              return `<td class="inactive-risk-hidden"></td>`;
            }

            /*return `<td style="${paddingStyle}">${cell}</td>`;*/
            return `<td style="${paddingStyle}" data-final="${cell}"></td>`;
          }).join('');
          tbody.appendChild(tr);

          setTimeout(() => {

            const cells = tr.querySelectorAll('td');
            cells.forEach(td => {
             /* const originalText = td.textContent;*/
              const originalText = td.getAttribute('data-final');
             /* if (td.querySelector('img')) return; */
             if (!originalText || td.querySelector('img')) return; // Skip icons or empty cells
              scrambleText(td, originalText, 600);
            }); 
          }, 300); // Delay after fade-in

        });
      })
      .catch(err => {
        document.querySelector('#leaderboard tbody').innerHTML = '<tr><td colspan="7">Failed to load data.</td></tr>';
        console.error('Failed to load CSV:', err);
      });
  </script>
</body>

</html>